<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Examen de Biología</title>
    <style>
        /* ===== Estilos básicos y responsive ===== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: white;
            width: 95%;
            max-width: 800px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        h1, h2 {
            text-align: center;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .question-container {
            margin-top: 20px;
        }
        .options label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .timer {
            text-align: center;
            font-size: 1.2em;
            margin-top: 10px;
            font-weight: bold;
        }
        @media(max-width: 600px){
            .navigation button {
                width: 48%;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- Formulario inicial -->
        <div id="formulario">
            <h1>Simulador Examen de Biología</h1>
            <label for="nombre">Nombre completo:</label>
            <input type="text" id="nombre" required>
            <label for="celular">Celular:</label>
            <input type="tel" id="celular" required pattern="[0-9]{6,15}" title="Ingrese un número válido">
            <label for="carrera">Carrera:</label>
            <input type="text" id="carrera" required>
            <button id="iniciar">Iniciar Examen</button>
        </div>

        <!-- Contenedor de examen -->
        <div id="examen" style="display:none;">
            <div class="timer" id="timer">Tiempo: 40:00</div>
            <div class="question-container">
                <h2 id="pregunta-texto"></h2>
                <div class="options" id="opciones"></div>
            </div>
            <div class="navigation">
                <button id="prevBtn">Anterior</button>
                <button id="nextBtn">Siguiente</button>
            </div>
        </div>

        <!-- Resultados -->
        <div id="resultado" style="display:none;">
            <h1>Resultado del Examen</h1>
            <p id="puntaje"></p>
            <p id="estado"></p>
        </div>
    </div>

    <script>
        // ===== Variables globales =====
        let preguntas = [];
        let seleccionadas = [];
        let respuestasUsuario = [];
        let tiempo = 40 * 60; // 40 minutos en segundos
        let timerInterval;
        let indexPregunta = 0;

        const formulario = document.getElementById('formulario');
        const examen = document.getElementById('examen');
        const resultado = document.getElementById('resultado');
        const timerDisplay = document.getElementById('timer');
        const preguntaTexto = document.getElementById('pregunta-texto');
        const opcionesDiv = document.getElementById('opciones');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        // ===== Función para cargar CSV =====
        async function cargarPreguntas() {
            const response = await fetch('preguntas.csv');
            const data = await response.text();
            const filas = data.split('\n');
            filas.forEach(fila => {
                const cols = fila.split(';');
                if(cols.length === 7){
                    preguntas.push({
                        id: cols[0],
                        pregunta: cols[1],
                        opciones: [cols[2], cols[3], cols[4], cols[5]],
                        respuesta: cols[6].trim().toUpperCase()
                    });
                }
            });
        }

        // ===== Función para seleccionar preguntas aleatorias =====
        function seleccionarPreguntas() {
            let temp = [...preguntas];
            seleccionadas = [];
            for(let i=0; i<40 && temp.length>0; i++){
                const idx = Math.floor(Math.random() * temp.length);
                seleccionadas.push(temp[idx]);
                temp.splice(idx, 1);
                respuestasUsuario.push(null); // Inicializamos respuestas
            }
        }

        // ===== Función para mostrar pregunta actual =====
        function mostrarPregunta() {
            const q = seleccionadas[indexPregunta];
            preguntaTexto.textContent = `Pregunta ${indexPregunta+1}: ${q.pregunta}`;
            opcionesDiv.innerHTML = '';
            ['A','B','C','D'].forEach((letra, i) => {
                const label = document.createElement('label');
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'opcion';
                radio.value = letra;
                if(respuestasUsuario[indexPregunta] === letra) radio.checked = true;
                label.appendChild(radio);
                label.append(` ${letra}: ${q.opciones[i]}`);
                opcionesDiv.appendChild(label);
            });
            prevBtn.style.display = indexPregunta === 0 ? 'none' : 'inline-block';
            nextBtn.textContent = indexPregunta === seleccionadas.length-1 ? 'Finalizar' : 'Siguiente';
        }

        // ===== Función para guardar respuesta =====
        function guardarRespuesta() {
            const radios = document.getElementsByName('opcion');
            radios.forEach(r => {
                if(r.checked) respuestasUsuario[indexPregunta] = r.value;
            });
        }

        // ===== Función para calcular puntaje =====
        function calcularResultado() {
            let puntaje = 0;
            seleccionadas.forEach((q,i) => {
                if(respuestasUsuario[i] === q.respuesta) puntaje += 2.5;
            });
            document.getElementById('puntaje').textContent = `Puntaje: ${puntaje.toFixed(2)}/100`;
            let estado = 'No Aprobado';
            if(puntaje > 81) estado = 'Admitido';
            else if(puntaje > 51) estado = 'Aprobado';
            document.getElementById('estado').textContent = `Estado: ${estado}`;
            examen.style.display = 'none';
            resultado.style.display = 'block';
            clearInterval(timerInterval);
        }

        // ===== Función de temporizador =====
        function iniciarTimer() {
            timerInterval = setInterval(() => {
                if(tiempo <= 0){
                    calcularResultado();
                } else {
                    let min = Math.floor(tiempo / 60);
                    let seg = tiempo % 60;
                    timerDisplay.textContent = `Tiempo: ${min.toString().padStart(2,'0')}:${seg.toString().padStart(2,'0')}`;
                    tiempo--;
                }
            }, 1000);
        }

        // ===== Evento iniciar examen =====
        document.getElementById('iniciar').addEventListener('click', async () => {
            const nombre = document.getElementById('nombre').value.trim();
            const celular = document.getElementById('celular').value.trim();
            const carrera = document.getElementById('carrera').value.trim();
            if(nombre === '' || celular === '' || carrera === ''){
                alert('Por favor complete todos los campos.');
                return;
            }
            formulario.style.display = 'none';
            examen.style.display = 'block';
            await cargarPreguntas();
            seleccionarPreguntas();
            mostrarPregunta();
            iniciarTimer();
        });

        // ===== Eventos de navegación =====
        nextBtn.addEventListener('click', () => {
            guardarRespuesta();
            if(indexPregunta === seleccionadas.length-1){
                calcularResultado();
            } else {
                indexPregunta++;
                mostrarPregunta();
            }
        });

        prevBtn.addEventListener('click', () => {
            guardarRespuesta();
            if(indexPregunta > 0){
                indexPregunta--;
                mostrarPregunta();
            }
        });

    </script>
</body>
</html>
